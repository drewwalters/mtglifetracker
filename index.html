<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: Arial;
  background: black;
  color: white;
}

.container {
  display: flex;
  flex-wrap: wrap;
  height: 100%;
}

.player {
  position: relative;
  border: 2px solid #111;
  box-sizing: border-box;
}

/* PLAYER NUMBER - top-right */
.playerNumber {
  position: absolute;
  top: 5px;
  left: 50%;
  font-size: 18px;
  font-weight: bold;
}

/* LIFE */
.life {
  position: absolute;
  top: 35%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 56px;
  z-index: 5;
}

/* COMMANDER BUTTON */
.cmdBtn {
  position: absolute;
  top: 65%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 20px;
  padding: 10px 16px;
  border-radius: 8px;
  border: none;
  background: #333;
  color: white;
  z-index: 20;
}

/* TOUCH ZONES */
.zone {
  position: absolute;
  width: 100%;
  height: 50%;
  z-index: 1;
}
.top { top: 0; }
.bottom { bottom: 0; }

.reset {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 50;
}

.menu {
  position: fixed;
  bottom: 5px;
  left: 5px;
  z-index: 50;
}

button {
  padding: 10px 16px;
  font-size: 16px;
}

/* MODAL */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.8);
}

.modalContent {
  background-color: #222;
  margin: 20% auto;
  padding: 20px;
  width: 80%;
  text-align: center;
  color: white;
  border-radius: 8px;
}

.modalContent input {
  font-size: 24px;
  width: 60px;
  text-align: center;
}
.modalContent button {
  font-size: 18px;
  margin: 10px;
  padding: 6px 12px;
}
</style>
</head>

<body>

<div class="container" id="container"></div>

<div class="reset">
  <button onclick="resetGame()">Reset</button>
</div>

<div class="menu">
  Players:
  <select onchange="setPlayers(this.value)">
    <option>2</option>
    <option>3</option>
    <option selected>4</option>
    <option>5</option>
    <option>6</option>
  </select>
</div>

<!-- MODAL FOR COMMANDER DAMAGE -->
<div id="modal" class="modal">
  <div class="modalContent">
    <div>Damage FROM Player:</div>
    <input id="fromPlayer" type="number" inputmode="numeric">
    <div>Add Damage:</div>
    <input id="damageAmount" type="number" inputmode="numeric">
    <br>
    <button onclick="submitCommander()">OK</button>
    <button onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
var startingLife = 40;
var players = 4;
var colors = ["#a33","#3a3","#33a","#aa3","#a3a","#3aa"];
var life = [];
var commander = [];
var currentCmdPlayer = null;

function init() {
  life = [];
  commander = [];
  for (var i = 0; i < players; i++) {
    life.push(startingLife);
    var row = [];
    for (var j = 0; j < players; j++) row.push(0);
    commander.push(row);
  }
  draw();
}

function setPlayers(n) {
  players = parseInt(n);
  init();
}

function layoutSize() {
  if (players == 2) return [50,100];
  if (players <= 4) return [50,50];
  return [33.3,50];
}

function draw() {
  var container = document.getElementById("container");
  container.innerHTML = "";
  var size = layoutSize();
  for (var i = 0; i < players; i++) {
    var div = document.createElement("div");
    div.className = "player";
    div.style.width = size[0] + "%";
    div.style.height = size[1] + "%";
    div.style.background = colors[i];

    // PLAYER NUMBER
    var num = document.createElement("div");
    num.className = "playerNumber";
    num.innerHTML = "Player " + (i+1);
    div.appendChild(num);

    // LIFE
    var l = document.createElement("div");
    l.className = "life";
    l.innerHTML = life[i];
    div.appendChild(l);

    // COMMANDER BUTTON
    var total = 0;
    for (var j = 0; j < players; j++) { if (i!=j) total += commander[i][j]; }
    var btn = document.createElement("button");
    btn.className = "cmdBtn";
    btn.innerHTML = "Cmd: " + total;
    btn.setAttribute("data-player", i);
    btn.onclick = openCommander;
    div.appendChild(btn);

    // TOUCH ZONES
    var top = document.createElement("div");
    top.className = "zone top";
    top.setAttribute("data-player", i);
    addPress(top, 1, 10);

    var bottom = document.createElement("div");
    bottom.className = "zone bottom";
    bottom.setAttribute("data-player", i);
    addPress(bottom, -1, -10);

    div.appendChild(top);
    div.appendChild(bottom);

    container.appendChild(div);
  }
}

// Life touch handling
function addPress(el, tap, hold) {
  var timer;
  el.ontouchstart = function () {
    var i = this.getAttribute("data-player");
    timer = setTimeout(function(){ changeLife(i, hold); timer=null; }, 400);
  };
  el.ontouchend = function () {
    var i = this.getAttribute("data-player");
    if(timer){ clearTimeout(timer); changeLife(i, tap);}
  };
}

function changeLife(i, amt){ life[i]+=amt; draw(); }

// Commander modal handling
function openCommander() {
  currentCmdPlayer = this.getAttribute("data-player");
  document.getElementById("fromPlayer").value = "";
  document.getElementById("damageAmount").value = "";
  document.getElementById("modal").style.display = "block";
  document.getElementById("fromPlayer").focus(); // iOS 9 numeric keyboard
}

function submitCommander() {
  var from = parseInt(document.getElementById("fromPlayer").value)-1;
  var amt = parseInt(document.getElementById("damageAmount").value);
  if(from>=0 && from<players && from != currentCmdPlayer && !isNaN(amt)){
    commander[currentCmdPlayer][from] += amt;
  }
  closeModal();
  draw();
}

function closeModal(){
  document.getElementById("modal").style.display="none";
}

function resetGame(){ init(); }

init();
</script>

</body>
</html>
